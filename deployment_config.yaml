# SongBloom Enterprise Deployment Configuration
# Supports iOS, Android, and Web deployments

version: "1.0"
project_name: "SongBloom-Enterprise"

# Common Configuration
common:
  app_name: "SongBloom"
  version: "3.0.0"
  build_number: 1
  bundle_id: "com.songbloom.enterprise"
  
  # Model Configuration
  models:
    voice_cloning:
      model_name: "ecapa_voxceleb"
      cache_dir: "./models/voice"
      on_device: true
    
    music_generation:
      model_name: "songbloom_full_150s"
      cache_dir: "./models/music"
      on_device: false
      server_url: "https://api.songbloom.ai/v1"
  
  # Security
  security:
    enable_ssl: true
    api_key_rotation: true
    max_file_size_mb: 50
    allowed_audio_formats: ["wav", "mp3", "flac", "ogg"]
    rate_limiting:
      enabled: true
      max_requests_per_minute: 30
  
  # Performance
  performance:
    max_concurrent_generations: 3
    cache_size_mb: 500
    enable_gpu_acceleration: true
    quantization: "int8"

# iOS Deployment
ios:
  enabled: true
  target:
    minimum_version: "14.0"
    device_family: ["iPhone", "iPad"]
  
  build:
    configuration: "Release"
    signing:
      team_id: "YOUR_TEAM_ID"
      provisioning_profile: "AppStore"
    
    export_method: "app-store"
    
  features:
    enable_app_store: true
    enable_testflight: true
    enable_enterprise_distribution: true
  
  frameworks:
    - "CoreML"
    - "AVFoundation"
    - "Accelerate"
  
  deployment:
    build_script: "./scripts/build_ios.sh"
    app_store_connect_key: "APP_STORE_API_KEY"
    
# Android Deployment
android:
  enabled: true
  target:
    minimum_sdk: 24  # Android 7.0
    target_sdk: 34   # Android 14
    compile_sdk: 34
  
  build:
    gradle_version: "8.2"
    build_type: "release"
    signing:
      keystore_path: "./keystore/songbloom-release.keystore"
      key_alias: "songbloom-key"
    
    abi_filters: ["armeabi-v7a", "arm64-v8a", "x86", "x86_64"]
    
  features:
    enable_play_store: true
    enable_apk_distribution: true
    enable_app_bundle: true
    
  permissions:
    - "android.permission.INTERNET"
    - "android.permission.READ_EXTERNAL_STORAGE"
    - "android.permission.WRITE_EXTERNAL_STORAGE"
    - "android.permission.RECORD_AUDIO"
    
  deployment:
    build_script: "./scripts/build_android.sh"
    play_store_track: "production"  # alpha, beta, production

# Web Deployment
web:
  enabled: true
  
  frontend:
    framework: "streamlit"  # or "react", "vue"
    build_dir: "./web/build"
    port: 8501
    
  backend:
    framework: "fastapi"
    port: 8000
    workers: 4
    timeout: 300
    
  hosting:
    platform: "streamlit_cloud"  # or "aws", "gcp", "azure", "heroku"
    domain: "app.songbloom.ai"
    ssl_enabled: true
    
    # Streamlit Cloud specific
    streamlit_cloud:
      python_version: "3.10"
      packages_file: "packages.txt"
      requirements_file: "requirements.txt"
      
    # Alternative: Docker deployment
    docker:
      enabled: true
      registry: "ghcr.io"
      image_name: "songbloom/enterprise"
      tag: "latest"
  
  cdn:
    enabled: true
    provider: "cloudflare"  # or "aws_cloudfront", "fastly"
    
  deployment:
    deploy_script: "./scripts/deploy_web.sh"
    ci_cd: "github_actions"  # or "gitlab_ci", "jenkins"

# Model Server Configuration (for server-based models)
model_server:
  enabled: true
  
  backend:
    framework: "fastapi"
    host: "0.0.0.0"
    port: 9000
    workers: 2
    
  infrastructure:
    platform: "kubernetes"  # or "docker_swarm", "ec2"
    
    kubernetes:
      namespace: "songbloom-prod"
      replicas: 3
      resources:
        gpu: 1
        memory: "16Gi"
        cpu: "4"
      
      autoscaling:
        enabled: true
        min_replicas: 2
        max_replicas: 10
        target_cpu_percent: 70
    
  monitoring:
    enabled: true
    prometheus: true
    grafana: true
    log_level: "INFO"

# CI/CD Configuration
ci_cd:
  platform: "github_actions"
  
  pipelines:
    ios:
      workflow_file: ".github/workflows/ios-build.yml"
      trigger: ["push", "tag"]
      
    android:
      workflow_file: ".github/workflows/android-build.yml"
      trigger: ["push", "tag"]
      
    web:
      workflow_file: ".github/workflows/web-deploy.yml"
      trigger: ["push", "tag"]
  
  testing:
    unit_tests: true
    integration_tests: true
    e2e_tests: true
    security_scans: true
    
  deployment:
    staging:
      auto_deploy: true
      approval_required: false
      
    production:
      auto_deploy: false
      approval_required: true
      rollback_enabled: true

# Monitoring & Analytics
monitoring:
  enabled: true
  
  error_tracking:
    sentry:
      enabled: true
      dsn: "YOUR_SENTRY_DSN"
      
  analytics:
    google_analytics: true
    mixpanel: true
    
  performance:
    apm_provider: "datadog"  # or "new_relic", "prometheus"
    
  logging:
    level: "INFO"
    retention_days: 30
    centralized: true
    provider: "elasticsearch"  # or "cloudwatch", "stackdriver"

# Backup & Recovery
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  
  targets:
    - type: "personas"
      location: "s3://songbloom-backups/personas"
    - type: "models"
      location: "s3://songbloom-backups/models"
    - type: "configs"
      location: "s3://songbloom-backups/configs"
  
  retention:
    daily: 7
    weekly: 4
    monthly: 12

# Feature Flags
feature_flags:
  voice_cloning: true
  multi_model_support: true
  offline_mode: true
  collaborative_features: false  # Coming soon
  real_time_generation: false    # Coming soon
